#!/usr/bin/env zsh

set -e

# curl https://www.gutenberg.org/files/4300/4300-0.txt -o /tmp/ulysses.txt

bench "ja '(+)|0 {%/Bloom/}{1}' -i /tmp/ulysses.txt" \
    "awk '/Bloom/ { total += 1; } END { print total }' /tmp/ulysses.txt" \
    "mawk '/Bloom/ { total += 1; } END { print total }' /tmp/ulysses.txt"

make bench/data/span.txt
bench "ja run examples/span.jac -i bench/data/span.txt" \
    "ja run examples/span2.jac -i bench/data/span.txt" \
    "original-awk -f examples/span.awk bench/data/span.txt" \
    "original-awk -f examples/span2.awk bench/data/span.txt" \
    "gawk -f examples/span.awk bench/data/span.txt" \
    "gawk -f examples/span2.awk bench/data/span.txt" \
    "mawk -f examples/span.awk bench/data/span.txt" \
    "mawk -f examples/span2.awk bench/data/span.txt" \
    "busybox awk -f examples/span.awk bench/data/span.txt" \
    "busybox awk -f examples/span2.awk bench/data/span.txt"

bench "ja '~.\$0' -i bench/data/span.txt" \
    "original-awk '!a[\$0]++' bench/data/span.txt" \
    "gawk '!a[\$0]++' bench/data/span.txt" \
    "mawk '!a[\$0]++' bench/data/span.txt" \
    "busybox awk '!a[\$0]++' bench/data/span.txt"

bench 'echo $PATH | ja run examples/path.jac' \
    'echo $PATH | original-awk -f examples/path.awk' \
    'echo $PATH | gawk -f examples/path.awk' \
    'echo $PATH | mawk -f examples/path.awk' \
    'echo $PATH | busybox awk -f examples/path.awk'

# ja run examples/glibc/haveversions.jac -i examples/data/Versions.all
# awk -f examples/glibc/haveversions.awk examples/data/Versions.all
